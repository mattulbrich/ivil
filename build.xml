<?xml version="1.0"?>
<!--!DOCTYPE project PUBLIC "-//ANT//DTD project//EN" "project.dtd"-->

<project name="PseudoHybris" default="nonnull" basedir=".">

  <property name="compile.debug" value="true" />
  <property name="compile.nonnullchecks" value="true" />
 
  <target name="init">
    <mkdir dir="classes"/>
    <mkdir dir="classes-test"/>
    <mkdir dir="genSrc"/>
  </target>

  <target name="build" depends="init, javacc, copy" description="compiles the sources">
    <javac srcdir="genSrc" destdir="classes" debug="${compile.debug}" sourcepath="genSrc:src"/>
    <javac srcdir="src" destdir="classes" debug="${compile.debug}">
       <classpath>
        <pathelement location="lib/javadocking.jar" />
      	<pathelement path="classes" />
      </classpath>
      <compilerarg value="-Xlint"/>
    </javac>
  </target>
	
  <target name="nonnull" depends="build" description="patches the class files with r/t checks" if="compile.nonnullchecks">
    <java classname="nonnull.NonNullPatch">
      <arg value="classes"/>
      <classpath>
        <pathelement location="lib/nonnull.jar"/>
      </classpath>
    </java> 
  </target>
	
  <target name="javacc" depends="init">
    <concat destfile="genSrc/de/uka/iti/pseudo/parser/Parser.jj">
      <fileset file="src/de/uka/iti/pseudo/parser/ParserHead.jj"/>
      <fileset file="src/de/uka/iti/pseudo/parser/FileParser.jj"/>
      <fileset file="src/de/uka/iti/pseudo/parser/TermParser.jj"/>
<!--      <fileset file="src/de/uka/iti/pseudo/parser/ProgramParser.jj"/> -->
    </concat>
    <exec executable="javacc">
      <arg value="-OUTPUT_DIRECTORY=genSrc/de/uka/iti/pseudo/parser"/>
      <arg value="genSrc/de/uka/iti/pseudo/parser/Parser.jj"/>
    </exec>
  </target>
	
  <target name="copy" depends="init">
    <copy todir="classes">
      <fileset dir="src">
        <include name="**/*.png" />
        <include name="**/*.properties" />
        <include name="META-INF/**" />     
      </fileset>  
    </copy>
  </target>

  <target name="jar" depends="build, nonnull" description="creates the jar file">
    <jar jarfile="pseudo.jar" basedir="classes"/>
  </target>

  <target name="build-test" depends="build" description="build test cases">
    <javac srcdir="test" destdir="classes-test" debug="${compile.debug}" sourcepath="test">
      <classpath>
        <pathelement location="lib/junit.jar" />
      	<pathelement path="classes" />
      </classpath>
    </javac>
  </target>

  <target name="nonnull-test" depends="build-test" description="patches the class files with r/t checks" if="compile.nonnullchecks">
    <java classname="nonnull.NonNullPatch">
      <arg value="classes-test"/>
      <classpath>
        <pathelement location="lib/nonnull.jar"/>
      </classpath>
    </java> 
  </target>

	
  <target name="test" depends="build-test" description="run junit tests">
    <junit printsummary="yes" fork="yes" haltonfailure="yes">
      <classpath>
        <pathelement path="classes"/>
        <pathelement path="classes-test"/>
        <!--<pathelement location="lib/javadocking.jar"/>-->
        <pathelement location="lib/nonnull.jar"/>
        <pathelement path="lib/junit.jar"/>
      </classpath>
      <test name="de.uka.iti.pseudo.AllTests"/>
      <formatter type="plain" />
    </junit>
  </target>

  <target name="javadoc" depends="init" description="Build Javadoc.">
    <mkdir dir="javadoc"/>
    <javadoc destdir="javadoc">
      <sourcepath>
        <pathelement location="src"/>
      </sourcepath>
      <fileset dir="src">
        <include name="**/*.java"/>
      </fileset>
      <link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
    </javadoc>
  </target>

  <target name="clean">
    <delete dir="classes" />
    <delete dir="classes-test" />
    <delete dir="genSrc" />
  </target>

</project>
